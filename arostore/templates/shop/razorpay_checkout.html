{% extends 'base.html' %}
{% load static %}

{% block title %}Payment - Aro Parts{% endblock %}

{% block content %}

<style>
    .payment-page {
        max-width: 500px;
        margin: 50px auto;
        padding: 30px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .payment-title {
        font-size: 24px;
        font-weight: 700;
        color: #202223;
        margin-bottom: 16px;
    }
    
    .payment-info {
        font-size: 14px;
        color: #6d7175;
        margin-bottom: 24px;
    }
    
    .order-summary {
        background: #f6f6f7;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 24px;
        text-align: left;
    }
    
    .order-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 14px;
    }
    
    .order-row.total {
        border-top: 1px solid #e1e3e5;
        margin-top: 8px;
        padding-top: 12px;
        font-weight: 700;
        font-size: 16px;
    }
    
    .loading-spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #008060;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .razorpay-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
        padding: 12px;
        background: #f6f6f7;
        border-radius: 8px;
    }
    
    .razorpay-badge img {
        height: 24px;
    }
    
    .razorpay-badge span {
        font-size: 13px;
        color: #6d7175;
    }
</style>

<div class="payment-page">
    <h1 class="payment-title">Redirecting to Payment...</h1>
    <p class="payment-info">Please wait while we redirect you to Razorpay to complete your payment securely.</p>
    
    <div class="order-summary">
        <div class="order-row">
            <span>Order ID</span>
            <span>#{{ order.id }}</span>
        </div>
        <div class="order-row total">
            <span>Total Amount</span>
            <span>â‚¹{{ order.total_amount }}</span>
        </div>
    </div>
    
    <div class="loading-spinner"></div>
    
    <div class="razorpay-badge">
        <span>ðŸ”’ Secured by</span>
        <img src="https://razorpay.com/assets/razorpay-logo.svg" alt="Razorpay">
    </div>
</div>

<!-- Razorpay Checkout Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    // Wait for page to load
    document.addEventListener('DOMContentLoaded', function() {
        
        // Razorpay options
        const options = {
            key: "{{ razorpay_key }}",  // Your Razorpay Key ID
            amount: "{{ amount }}",     // Amount in paise
            currency: "INR",
            name: "Aro Parts",
            description: "Order Payment - #{{ order.id }}",
            order_id: "{{ razorpay_order_id }}",  // Razorpay order ID
            handler: function(response) {
                // Payment successful - redirect to success page
                console.log("Payment successful:", response);
                window.location.href = "/payment/success/{{ order.id }}/";
            },
            prefill: {
                name: "{{ customer_name }}",
                email: "{{ customer_email }}",
                contact: "{{ customer_phone }}"
            },
            theme: {
                color: "#008060"  // Your brand color
            },
            modal: {
                ondismiss: function() {
                    // User closed the payment modal
                    window.location.href = "/payment/cancel/{{ order.id }}/";
                }
            }
        };
        
        // Open Razorpay checkout
        const rzp1 = new Razorpay(options);
        rzp1.open();
    });
</script>

{% endblock %}